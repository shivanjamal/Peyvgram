<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SocialApp - App Style</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
<style>
body { font-family: 'Inter', sans-serif; margin:0; padding:0; background:#f0f2f5; display:flex; flex-direction:column; align-items:center; min-height:100vh; transition: background 0.3s;}
.dark-theme { background:#1a1a2e; color:#fff;}
.header { width:100%; background:#3b82f6; padding:15px 20px; display:flex; justify-content:space-between; align-items:center; color:white; box-shadow:0 4px 8px rgba(0,0,0,0.2);}
.header .title { font-weight:700; font-size:1.2em;}
.header button { border:none; padding:6px 12px; border-radius:8px; cursor:pointer; font-weight:600;}
.feed { max-width:500px; width:100%; margin:15px auto; display:flex; flex-direction:column; gap:12px;}
.post-card { background:white; border-radius:12px; padding:12px; box-shadow:0 4px 12px rgba(0,0,0,0.1); transition: transform 0.2s;}
.dark-theme .post-card { background:#2c2c44; }
.post-card:hover { transform:translateY(-4px);}
.post-card .author { font-weight:700; margin-bottom:6px; }
.post-card .text { font-size:0.95em; margin-bottom:8px;}
.post-card .actions { display:flex; gap:12px; font-size:0.85em; color:#555; cursor:pointer;}
.dark-theme .actions { color:#ccc; }
.modal { position:fixed; inset:0; background:rgba(0,0,0,0.6); display:none; justify-content:center; align-items:center; z-index:1000; }
.modal-content { background:white; padding:20px; border-radius:12px; max-width:400px; width:90%; }
.dark-theme .modal-content { background:#2c2c44; color:white; }
input, textarea { width:100%; padding:10px; margin:6px 0; border-radius:8px; border:1px solid #ccc; font-size:14px; }
button.primary { background:#3b82f6; color:white; }
button.primary:hover { opacity:0.9; }
</style>
</head>
<body>

<header class="header">
  <div class="title">SocialApp</div>
  <div>
    <button id="theme-toggle">ðŸŒ“</button>
    <button id="logout-btn" style="display:none;">Logout</button>
  </div>
</header>

<section class="feed" id="feed">
  <div class="composer">
    <textarea id="post-text" placeholder="Write something..."></textarea>
    <button class="primary" id="post-btn">Post</button>
  </div>
</section>

<!-- Login Modal -->
<div class="modal" id="login-modal">
  <div class="modal-content">
    <h2>Sign in with Google</h2>
    <button id="google-login" class="primary">Sign in</button>
  </div>
</div>

<!-- Display Name Modal -->
<div class="modal" id="name-modal">
  <div class="modal-content">
    <h2>Enter your display name</h2>
    <input type="text" id="display-name" placeholder="Your name"/>
    <button class="primary" id="save-name">Save</button>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-app.js";
import { getAuth, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-auth.js";
import { getFirestore, collection, addDoc, query, orderBy, onSnapshot, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-firestore.js";

const firebaseConfig = {
  apiKey:"AIzaSyBiX0jhmNgyv_CAudswKUKXqf4B_YGckwo",
  authDomain:"kurdishapp-16185.firebaseapp.com",
  projectId:"kurdishapp-16185",
  storageBucket:"kurdishapp-16185.appspot.com",
  messagingSenderId:"1092263652082",
  appId:"1:1092263652082:web:447c6fe6822c02a2453e6b"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);
const provider = new GoogleAuthProvider();

const loginModal = document.getElementById("login-modal");
const googleLogin = document.getElementById("google-login");
const nameModal = document.getElementById("name-modal");
const saveNameBtn = document.getElementById("save-name");
const displayNameInput = document.getElementById("display-name");
const logoutBtn = document.getElementById("logout-btn");
const feed = document.getElementById("feed");
const postBtn = document.getElementById("post-btn");
const postText = document.getElementById("post-text");
const themeToggle = document.getElementById("theme-toggle");

let currentUser = null;
let userName = "";

function showLogin(){ loginModal.style.display="flex";}
function hideLogin(){ loginModal.style.display="none";}
function showNameModal(){ nameModal.style.display="flex";}
function hideNameModal(){ nameModal.style.display="none";}

// Theme toggle
themeToggle.onclick = () => {
  document.body.classList.toggle("dark-theme");
  localStorage.setItem("theme", document.body.classList.contains("dark-theme")?"dark":"light");
};
if(localStorage.getItem("theme")==="dark") document.body.classList.add("dark-theme");

// Login flow
googleLogin.onclick = async () => {
  try{
    const result = await signInWithPopup(auth, provider);
    currentUser = result.user;
    // Check if display name is stored in Firestore
    const q = query(collection(db,"users"));
    onSnapshot(q,snap=>{
      const exists = snap.docs.some(d=>d.id===currentUser.uid);
      if(!exists) showNameModal();
      else { userName = snap.docs.find(d=>d.id===currentUser.uid).data().name; hideLogin(); loadPosts(); logoutBtn.style.display="inline-block";}
    });
  } catch(e){ console.error(e);}
};

// Save display name
saveNameBtn.onclick = async () => {
  if(!displayNameInput.value.trim()) return alert("Enter a name!");
  userName = displayNameInput.value.trim();
  await addDoc(collection(db,"users"),{id:currentUser.uid,name:userName});
  hideNameModal();
  hideLogin();
  loadPosts();
  logoutBtn.style.display="inline-block";
};

// Logout
logoutBtn.onclick = () => signOut(auth).then(()=>window.location.reload());

// Compose post
postBtn.onclick = async () => {
  if(!postText.value.trim()) return;
  await addDoc(collection(db,"posts"),{
    text: postText.value.trim(),
    author: userName,
    createdAt: serverTimestamp()
  });
  postText.value="";
};

// Load posts
function loadPosts(){
  const q = query(collection(db,"posts"),orderBy("createdAt","desc"));
  onSnapshot(q,snap=>{
    feed.querySelectorAll(".post-card").forEach(n=>n.remove());
    snap.forEach(docSnap=>{
      const data = docSnap.data();
      const card = document.createElement("div");
      card.className="post-card";
      card.innerHTML=`<div class="author">${data.author}</div><div class="text">${data.text}</div>`;
      feed.appendChild(card);
    });
  });
}

// Show login modal initially
showLogin();

</script>
</body>
</html>